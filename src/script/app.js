(()=>{"use strict";class e{constructor(){this.resetBtn=document.querySelector(".forgot-btn")}getInput(){return{email:document.getElementById("email").value}}updateUI(){const e=document.querySelector(".forgot-btn"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".forgot-btn"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}let t={};const n=async(e,t,n)=>{const s={method:t,credentials:"include",headers:{"Content-Type":"application/json"}};n&&(s.body=JSON.stringify(n));try{const t=await fetch(`http://localhost:9090${e}`,s);return await t.json()}catch(e){console.log(e)}};class s{constructor(){}showPopup(e){const t=document.querySelector(".popup");t.textContent=e,t.style.display="block",t.style.opacity="1"}hidePopup(){setTimeout((()=>{const e=document.querySelector(".popup");e.style.display="none",e.style.opacity="0"}),3e3)}}class a{constructor(){this.bg=document.querySelector(".bg")}showSpinner(){this.bg.classList.remove("hidden")}hideSpinner(){this.bg.classList.add("hidden")}}const o=new s;class i{constructor(){this.resetBtn=document.querySelector(".reset-btn")}getInput(){const e=document.querySelector("[name='new-password']").value,t=document.querySelector("[name='confirm-new-password']").value;return{password:e.toString(),confirmPassword:t.toString()}}updateUI(){const e=document.querySelector(".reset-btn-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".reset-btn-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}const c=new a,r=new s,d=async e=>{try{await n("/api/user/logout","GET"),e.defaultUI(),window.location.href="/",c.hideSpinner()}catch(e){console.log(e)}},u=new a;class l{constructor(){this.navBarList=document.querySelector(".list")}updateUI(e){const t=document.querySelector(".user-not-loggedin"),n=document.querySelector(".user-loggedin");document.querySelector(".user-name").innerText=`Welcome, ${e.data.user.name.split(" ")[0]}`,t.classList.add("hidden"),n.classList.remove("hidden"),u.hideSpinner()}defaultUI(){const e=document.querySelector(".user-not-loggedin"),t=document.querySelector(".user-loggedin");e.classList.remove("hidden"),t.classList.add("hidden")}getlogoutBtn(){const e=document.querySelector(".logout-btn");if(e)return e}}const p=new s,m=async(e,t)=>{const s=await n(`/api/user/reset-password?token=${t}`,"POST",e);if("Fail"===s.status)p.showPopup(s.message),p.hidePopup(),resetPasswordView.defaultUI();else{p.showPopup(s.message),p.hidePopup();const e=new l;setTimeout((async()=>{await d(e)}),2e3),resetPasswordView.defaultUI()}};class w{constructor(){this.passwordUpdateBtn=document.querySelector(".password-save-btn"),this.logoutBtn=document.querySelector(".log-out-btn"),this.nameUpdateBtn=document.querySelector(".name-save-btn"),this.emailUpdateBtn=document.querySelector(".email-save-btn")}setInput(e){document.getElementById("account-name").value=e.data.user.name,document.getElementById("account-email").value=e.data.user.email}getPasswordInput(){return{currentPassword:document.getElementById("current-password").value,newPassword:document.getElementById("new-password").value,confirmNewPassword:document.getElementById("confirm-new-password").value}}getNameInput(){return{name:document.getElementById("account-name").value}}getEmailInput(){return{email:document.getElementById("account-email").value}}resetInput(){document.getElementById("current-password").value="",document.getElementById("new-password").value="",document.getElementById("confirm-new-password").value=""}updatePasswordBtnUI(){this.passwordUpdateBtn.textContent="Updating..."}resetPasswordBtnUI(){this.passwordUpdateBtn.textContent="Update Password"}updateNameBtnUI(){this.nameUpdateBtn.textContent="Updating..."}resetNameBtnUI(){this.nameUpdateBtn.textContent="Update Name"}updateEmailBtnUI(){this.emailUpdateBtn.textContent="Updating..."}resetEmailBtnUI(){this.emailUpdateBtn.textContent="Update Email"}}const g=new l,h=new a;let v=!1;class f{constructor(){this.loginBtn=document.querySelector(".login-btn")}getLoginInputs(){return{email:document.getElementById("email").value,password:document.getElementById("password").value}}updateUI(){const e=document.querySelector(".login-btn-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".login-btn-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}resetInput(){document.getElementById("password").value=""}disableLoginBtn(){this.loginBtn.disabled=!0}}const y=new s,I=new a;class S{constructor(){this.tourContainer=document.querySelector(".tour-container")}generateMarkup(e){const t=` <div class="tour">\n    <div class="tour-header">\n      <span class="image-overlay"></span>\n      <img src="./src/img/biking.jpg" alt="" class="tour-img">\n    </div>\n    <div class="tour-content">\n      <p class="tour-title">${e.name}</p>\n      <p class="tour-content-fact">${e.difficulty.toUpperCase()} ${e.tourLength} Days </p>\n      <p class="tour-content-info">${e.info}\n      </p>\n      <div class="tour-icons">\n        <div class="tour-content-icon">\n          <i class="far fa-map"></i>\n          <p>${e.location}</p>\n        </div>\n        <div class="tour-content-icon">\n          <i class="far fa-calendar"></i>\n          <p>June 2022</p>\n        </div>\n        <div class="tour-content-icon">\n          <i class="far fa-user"></i>\n          <p>${e.groupSize}</p>\n        </div>\n        <div class="tour-content-icon">\n          <i class="far fa-hourglass"></i>\n          <p>${e.tourLength}</p>\n        </div>\n      </div>\n    </div>\n    <div class="tour-footer">\n      <div class="tour-ratings">\n        <p class="tour-price">$${e.price} <span>per person</span></p>\n        <div class="tour-rating">${e.averageRatings} <span>rating (${e.totalRatings})</span></div>\n      </div>\n      <div class="tour-btn">\n        <a href="/tour-detail.html?id=${e._id}" class="tour-link">Details</a>\n      </div>\n    </div>\n  </div>`;this.tourContainer.insertAdjacentHTML("afterbegin",t)}}class B{constructor(){this.otpBtn=document.querySelector(".send-otp-btn")}getInput(){return{OTP:document.querySelector("[name='update-email']").value}}updateUI(){const e=document.querySelector(".send-otp-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}resetUI(){const e=document.querySelector(".send-otp-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}const U=new s;class P{constructor(){this.signupbtn=document.querySelector(".signup-btn")}getInputs(){return{email:document.getElementById("email").value,password:document.getElementById("password").value,confirmPassword:document.getElementById("confirm-password").value,name:document.getElementById("name").value}}resetInput(){document.getElementById("password").value="",document.getElementById("confirm-password").value=""}updateUI(){const e=document.querySelector(".signup-btn-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".signup-btn-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}class L{constructor(){this.tourContainer=document.querySelector(".tour-container")}generateMarkup(e){const t=`<div class="tour">\n        <i class="far fa-bookmark"></i>\n        <div class="tour-info">\n        <div class="tour-title">\n        <span>${e.name}</span>\n\n        </div>\n            <div class="tour-info-details">\n                <div class="tour-info-detail">\n                    <i class="far fa-clock"></i>\n                    <p>${e.tourLength} Days</p>\n                </div>\n                <div class="tour-info-detail">\n                    <i class="far fa-map"></i>\n                    <p>${e.location}</p>\n                </div>\n            </div>\n        </div>\n      </div>\n      <div class="tour-facts">\n        <div class="tour-facts-left">\n          <p class="tour-quick-facts">Quick Facts</p>\n          <div class="tour-facts-items">\n            <div class="tour-facts-item">\n              <i class="far fa-calendar-minus"></i>\n              <span>Next Date</span>\n              <p>June 2021</p>\n            </div>\n            <div class="tour-facts-item">\n              <i class="far fa-chart-bar"></i>\n              <span>Difficulty</span>\n              <p>${e.difficulty}</p>\n            </div>\n            <div class="tour-facts-item">\n              <i class="far fa-user"></i>\n              <span>Group Size</span>\n              <p>6</p>\n            </div>\n            <div class="tour-facts-item">\n              <i class="far fa-star"></i>\n              <span>Ratings</span>\n              <p>${e.averageRatings} / ${e.totalRatings}</p>\n            </div>\n          </div>\n        </div>\n        <div class="tour-facts-right">\n          <p class="tour-quick-facts">About the Mountain Biking</p>\n          <p class="tour-description">\n          ${e.info}\n          </p>\n          <p class="tour-description">\n                ${e.description}\n          </p>\n        </div>\n    </div>\n    <div class="tour-images">\n      <img src="./src/img/1.jpg" alt="">\n      <img src="./src/img/2.jpg" alt="">\n      <img src="./src/img/3.jpg" alt="">\n    </div>\n    <div class="tour-review">\n      \n    </div>`;this.tourContainer.innerHTML="",this.tourContainer.insertAdjacentHTML("afterbegin",t);const n=document.querySelector(".tour-review"),s=e.reviews.map((e=>{const t=[];for(let n=0;n<e.rating;n++)t.push('<i class="fas fa-star">');return`<div class="review">\n        <div class="review-info">\n          <img src="./src/img/test.jpg" alt="reviewer-img">\n          <p class="reviewer-name">TEMPORARY NAME</p>\n        </div>\n        <p class="review-text">${e.review}</p>\n        <div class="review-ratings">\n           ${t.join("\n")}\n        </div>\n      </div>`}));n.insertAdjacentHTML("afterbegin",s.join("\n")),document.querySelector(".review-ratings").nextElementSibling.remove()}}const q=new a;(async()=>{try{q.showSpinner(),await(async()=>{try{const e=await n("/api/user/about-me","GET");"success"===e.status&&(g.updateUI(e),v=!0,t=e),h.hideSpinner()}catch(e){console.log(e)}})(),await(async()=>{if("/activate-account.html"===window.location.pathname){const e=window.location.search.split("=")[1];if(!e)return window.location.href="/";const t=await n(`/api/user/activate-account?verify=${e}`,"GET");"success"===t.status?window.location.href="/login.html?activated=true":document.write(t.message)}})(),(async()=>{if("/tours.html"==window.location.pathname){const e=new a,t=new S;(await n("/api/tour","GET")).data.tours.forEach((e=>{t.generateMarkup(e)})),e.hideSpinner()}})(),(async()=>{if("/tour-detail.html"==window.location.pathname){const e=window.location.search.split("=")[1];if(!e)return window.location.href="/tours.html";await(async e=>{const t=await n(`/api/tour/${e}`,"GET");console.log(t),(new L).generateMarkup(t.data.tour)})(e)}})(),(async()=>{if("/forgot-password.html"==window.location.pathname){const t=new a,s=new e;s.resetBtn.addEventListener("click",(async function(){s.updateUI();const e=s.getInput();await(async e=>{const t=await n("/api/user/forgot-password","POST",e);t.status,o.showPopup(t.message),o.hidePopup()})(e),s.defaultUI()})),t.hideSpinner()}})(),(()=>{if("/reset-password.html"===window.location.pathname){const e=new a,t=window.location.search.split("=")[1];if(!t)return window.location.href="/";const n=new i;n.resetBtn.addEventListener("click",(async function(){n.updateUI();const e=n.getInput();if(e.password!==e.confirmPassword)return p.showPopup("Passwords do not match"),p.hidePopup(),void n.defaultUI();await m(e,t)})),e.hideSpinner()}})(),(()=>{if("/dashboard.html"==window.location.pathname){if(!v)return window.location.href="/login.html?notLoggedIn=true";const e=new a,s=new w;s.setInput(t),s.passwordUpdateBtn.addEventListener("click",(async function(e){(async(e,t)=>{e.preventDefault(),t.updatePasswordBtnUI();const s=t.getPasswordInput();await(async e=>{const t=await n("/api/user/update-me/password","POST",e);r.showPopup(t.message),r.hidePopup()})(s),t.resetPasswordBtnUI()})(e,s)})),s.logoutBtn.addEventListener("click",(async function(){const e=new l;await d(e)})),s.nameUpdateBtn.addEventListener("click",(async function(e){(async(e,t)=>{e.preventDefault(),t.updateNameBtnUI();const s=t.getNameInput();await(async e=>{const t=await n("/api/user/update-me/info","POST",e);r.showPopup(t.message),r.hidePopup()})(s),t.resetNameBtnUI()})(e,s)})),s.emailUpdateBtn.addEventListener("click",(async function(e){(async(e,t)=>{e.preventDefault(),t.updateEmailBtnUI();const s=t.getEmailInput();await(async e=>{const t=await n("/api/user/update-me/email","POST",e);r.showPopup(t.message),r.hidePopup()})(s),t.resetEmailBtnUI()})(e,s)})),e.hideSpinner()}})(),(()=>{if("/login.html"===window.location.pathname&&"?activated=true"===window.location.search&&setTimeout((()=>{y.showPopup("Account verified"),y.hidePopup()}),500),"/login.html"==window.location.pathname){I.showSpinner();const e=new f;e.loginBtn.addEventListener("click",(function(){(async e=>{try{e.updateUI();const t=e.getLoginInputs(),s=await n("/api/user/login","POST",t);if("Fail"===s.status)e.defaultUI(),e.resetInput(),r.showPopup(s.message),r.hidePopup();else{const t=await n("/api/user/about-me","GET");window.sessionStorage.setItem("user",JSON.stringify(t)),window.sessionStorage.setItem("isUserLoggedIn",!0),e.defaultUI(),window.location.href="/"}}catch(e){console.log(e)}})(e)})),I.hideSpinner()}"/login.html"==window.location.pathname&&"?notLoggedIn=true"===window.location.search&&setTimeout((()=>{y.showPopup("You are not logged in! Please log in."),y.hidePopup()}),500)})(),(()=>{if("/signup.html"==window.location.pathname){const e=new P;e.signupbtn.addEventListener("click",(function(){(async e=>{e.updateUI();const t=e.getInputs(),s=await n("/api/user/signup","POST",t);s.data?r.showPopup(s.data.message):r.showPopup(s.message),e.resetInput(),r.hidePopup(),e.defaultUI()})(e)}))}})(),(()=>{if("/update-email.html"===window.location.pathname){const e=new B,t=window.location.search.split("=")[1];if(!t)return window.location.href="/";e.otpBtn.addEventListener("click",(async function(){e.updateUI();const s=e.getInput();await(async(e,t)=>{const s=await n(`/api/user/update-email?token=${t}`,"POST",e);U.showPopup(s.message),U.hidePopup(),"success"===s.status&&setTimeout((()=>{window.location.href="/login.html"}),2e3)})(s,t),e.resetUI()}))}})(),q.hideSpinner()}catch(e){console.log(e)}})()})();