(()=>{"use strict";class e{constructor(){this.resetBtn=document.querySelector(".forgot-btn")}getInput(){return{email:document.getElementById("email").value}}updateUI(){const e=document.querySelector(".forgot-btn"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".forgot-btn"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}let t=JSON.parse(window.sessionStorage.getItem("isUserLoggedIn")),o=JSON.parse(window.sessionStorage.getItem("user"));const n=async(e,t,o)=>{const n={method:t,credentials:"include",headers:{"Content-Type":"application/json"}};o&&(n.body=JSON.stringify(o));try{const t=await fetch(`http://localhost:9090${e}`,n);return await t.json()}catch(e){console.log(e)}};class s{constructor(){}showPopup(e){const t=document.querySelector(".popup");t.textContent=e,t.style.display="block",t.style.opacity="1"}hidePopup(){setTimeout((()=>{const e=document.querySelector(".popup");e.style.display="none",e.style.opacity="0"}),3e3)}}const a=new s;class i{constructor(){this.resetBtn=document.querySelector(".reset-btn")}getInput(){const e=document.querySelector("[name='new-password']").value,t=document.querySelector("[name='confirm-new-password']").value;return{password:e.toString(),confirmPassword:t.toString()}}}class c{constructor(){this.bg=document.querySelector(".bg")}showSpinner(){this.bg.classList.remove("hidden")}hideSpinner(){this.bg.classList.add("hidden")}}const r=new c,d=new s,u=async e=>{try{r.showSpinner(),await n("/api/user/logout","GET"),e.defaultUI(),window.sessionStorage.setItem("isUserLoggedIn",!1),window.sessionStorage.setItem("user",!1),window.location.href="/",r.hideSpinner()}catch(e){console.log(e)}},l=new c;class w{constructor(){this.navBarList=document.querySelector(".list")}updateUI(e){const t=document.querySelector(".user-not-loggedin"),o=document.querySelector(".user-loggedin");document.querySelector(".user-name").innerText=`Welcome, ${e.data.user.name.split(" ")[0]}`,t.classList.add("hidden"),o.classList.remove("hidden"),l.hideSpinner()}defaultUI(){const e=document.querySelector(".user-not-loggedin"),t=document.querySelector(".user-loggedin");e.classList.remove("hidden"),t.classList.add("hidden")}getlogoutBtn(){const e=document.querySelector(".logout-btn");if(e)return e}}const p=new s;class m{constructor(){}setInput(e){document.getElementById("account-name").value=e.name,document.getElementById("account-email").value=e.email}notLoggedIn(){window.location.href="/login.html?notLoggedIn=true"}getLogoutBtn(){return document.querySelector(".log-out-btn")}}const g=new c;class h{constructor(){this.loginBtn=document.querySelector(".login-btn")}getLoginInputs(){return{email:document.getElementById("email").value,password:document.getElementById("password").value}}updateUI(){const e=document.querySelector(".login-btn-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".login-btn-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}resetInput(){document.getElementById("password").value=""}disableLoginBtn(){this.loginBtn.disabled=!0}}const y=new s,S=new c,I=new c;(async()=>{try{t&&(I.showSpinner(),new w(I).updateUI(o)),(async()=>{if("/forgot-password.html"==window.location.pathname){const t=new e;t.resetBtn.addEventListener("click",(async function(){t.updateUI();const e=t.getInput();await(async e=>{const t=await n("/api/user/forgot-password","POST",e);t.status,a.showPopup(t.message),a.hidePopup()})(e),t.defaultUI()}))}})(),(()=>{if("/reset-password.html"===window.location.pathname){const e=window.location.search.split("=")[1];e||(window.location.href="/");const t=new i;t.resetBtn.addEventListener("click",(async function(){const o=t.getInput();if(o.password!==o.confirmPassword)return p.showPopup("Passwords do not match"),void p.hidePopup();await(async(e,t)=>{const o=await n(`/api/user/reset-password?token=${t}`,"POST",e);if("Fail"===o.status)p.showPopup(o.message),p.hidePopup();else{p.showPopup(o.message),p.hidePopup();const e=new w;setTimeout((async()=>{await u(e)}),2e3)}})(o,e)}))}})(),(()=>{if("/dashboard.html"==window.location.pathname){g.showSpinner();const e=new m,t=new w;e.setInput({name:"FAKE NAME",email:"FAKE EMAIL"}),e.getLogoutBtn().addEventListener("click",(function(){u(t)}))}})(),(()=>{if("/login.html"===window.location.pathname&&"?activated=true"===window.location.search&&setTimeout((()=>{y.showPopup("Account verified"),y.hidePopup()}),500),"/login.html"==window.location.pathname){const e=new h;e.loginBtn.addEventListener("click",(function(){(async e=>{try{const t=e.getLoginInputs();e.updateUI();const o=await n("/api/user/login","POST",t);if("Fail"===o.status)e.defaultUI(),e.resetInput(),d.showPopup(o.message),d.hidePopup();else{const t=await n("/api/user/about-me","GET");window.sessionStorage.setItem("user",JSON.stringify(t)),window.sessionStorage.setItem("isUserLoggedIn",!0),e.defaultUI(),window.location.href="/"}}catch(e){console.log(e)}})(e)}))}"/login.html"==window.location.pathname&&"?notLoggedIn=true"===window.location.search&&setTimeout((()=>{y.showPopup("You are not logged in! Please log in."),y.hidePopup()}),500)})(),(async()=>{if("/activate-account.html"===window.location.pathname){const e=window.location.search.split("=")[1],t=await n(`/api/user/activate-account?verify=${e}`,"GET");"success"===t.status?window.location.href="/login.html?activated=true":document.write(t.message)}else S.showSpinner()})(),I.hideSpinner()}catch(e){console.log(e)}})()})();