(()=>{"use strict";class e{constructor(){this.resetBtn=document.querySelector(".forgot-btn")}getInput(){return{email:document.getElementById("email").value}}updateUI(){const e=document.querySelector(".forgot-btn"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".forgot-btn"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}const t="https://naturist.herokuapp.com";let n={};const o=async(e,n,o)=>{const a={method:n,credentials:"include",headers:{"Content-Type":"application/json"}};o&&(a.body=JSON.stringify(o));try{const n=await fetch(`${t}${e}`,a);return await n.json()}catch(e){console.log(e)}};class a{constructor(){}showPopup(e){const t=document.querySelector(".popup");t.textContent=e,t.style.display="block",t.style.opacity="1"}hidePopup(){setTimeout((()=>{const e=document.querySelector(".popup");e.style.display="none",e.style.opacity="0"}),3e3)}}class s{constructor(){this.bg=document.querySelector(".bg")}showSpinner(){this.bg.classList.remove("hidden")}hideSpinner(){this.bg.classList.add("hidden")}}const i=new a;class r{constructor(){this.resetBtn=document.querySelector(".reset-btn")}getInput(){const e=document.querySelector("[name='new-password']").value,t=document.querySelector("[name='confirm-new-password']").value;return{password:e.toString(),confirmPassword:t.toString()}}updateUI(){const e=document.querySelector(".reset-btn"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".reset-btn"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}const c=new s,d=new a,u=async e=>{try{await o("/api/user/logout","GET"),e.defaultUI(),window.location.href="/",c.hideSpinner()}catch(e){console.log(e)}},l=new s;class p{constructor(){this.navBarList=document.querySelector(".list")}updateUI(e){const t=document.querySelector(".user-not-loggedin"),n=document.querySelector(".user-loggedin");document.querySelector(".user-name").innerText=`Welcome, ${e.data.user.name.split(" ")[0]}`,t.classList.add("hidden"),n.classList.remove("hidden"),l.hideSpinner()}defaultUI(){const e=document.querySelector(".user-not-loggedin"),t=document.querySelector(".user-loggedin");e.classList.remove("hidden"),t.classList.add("hidden")}getlogoutBtn(){const e=document.querySelector(".logout-btn");if(e)return e}}const m=new a,w=async(e,t)=>{const n=await o(`/api/user/reset-password?token=${t}`,"POST",e);if("Fail"===n.status)m.showPopup(n.message),m.hidePopup(),resetPasswordView.defaultUI();else{m.showPopup(n.message),m.hidePopup();const e=new p;setTimeout((async()=>{await u(e)}),2e3),resetPasswordView.defaultUI()}};class g{constructor(){this.passwordUpdateBtn=document.querySelector(".password-save-btn"),this.logoutBtn=document.querySelector(".log-out-btn"),this.nameUpdateBtn=document.querySelector(".name-save-btn"),this.emailUpdateBtn=document.querySelector(".email-save-btn")}setInput(e){document.getElementById("account-name").value=e.data.user.name,document.getElementById("account-email").value=e.data.user.email}getPasswordInput(){return{currentPassword:document.getElementById("current-password").value,newPassword:document.getElementById("new-password").value,confirmNewPassword:document.getElementById("confirm-new-password").value}}getNameInput(){return{name:document.getElementById("account-name").value}}getEmailInput(){return{email:document.getElementById("account-email").value}}resetInput(){document.getElementById("current-password").value="",document.getElementById("new-password").value="",document.getElementById("confirm-new-password").value=""}updatePasswordBtnUI(){this.passwordUpdateBtn.textContent="Updating..."}resetPasswordBtnUI(){this.passwordUpdateBtn.textContent="Update Password"}updateNameBtnUI(){this.nameUpdateBtn.textContent="Updating..."}resetNameBtnUI(){this.nameUpdateBtn.textContent="Update Name"}updateEmailBtnUI(){this.emailUpdateBtn.textContent="Updating..."}resetEmailBtnUI(){this.emailUpdateBtn.textContent="Update Email"}}const h=new p,v=new s;let y=!1;class f{constructor(){this.loginBtn=document.querySelector(".login-btn")}getLoginInputs(){return{email:document.getElementById("email").value,password:document.getElementById("password").value}}updateUI(){const e=document.querySelector(".login-btn-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".login-btn-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}resetInput(){document.getElementById("password").value=""}disableLoginBtn(){this.loginBtn.disabled=!0}}const I=new a,S=new s;class B{constructor(){this.tourContainer=document.querySelector(".tour-container"),this.nextPageBtn=document.querySelector(".next-page"),this.prevPageBtn=document.querySelector(".prev-page"),this.currentPage=document.querySelector(".current-page"),this.loadMoreBtn=document.querySelector(".load-more")}getQuery(){return window.location.search}increasePageNumber(){this.nextPageBtn.dataset.currentpage++}generateMarkup(e){const n=` <div class="tour">\n    <div class="tour-header">\n      <span class="image-overlay"></span>\n      <img src="${t}/${e.headImg}" alt="" class="tour-img">\n    </div>\n    <div class="tour-content">\n      <p class="tour-title">${e.name}</p>\n      <p class="tour-content-fact">${e.difficulty.toUpperCase()} ${e.tourLength} Days </p>\n      <p class="tour-content-info">${e.info}\n      </p>\n      <div class="tour-icons">\n        <div class="tour-content-icon">\n          <i class="far fa-map"></i>\n          <p>${e.location}</p>\n        </div>\n        <div class="tour-content-icon">\n          <i class="far fa-calendar"></i>\n          <p>June 2022</p>\n        </div>\n        <div class="tour-content-icon">\n          <i class="far fa-user"></i>\n          <p>${e.groupSize}</p>\n        </div>\n        <div class="tour-content-icon">\n          <i class="far fa-hourglass"></i>\n          <p>${e.tourLength}</p>\n        </div>\n      </div>\n    </div>\n    <div class="tour-footer">\n      <div class="tour-ratings">\n        <p class="tour-price">$${e.price} <span>per person</span></p>\n        <div class="tour-rating">${e.averageRatings} <span>rating (${e.totalRatings})</span></div>\n      </div>\n      <div class="tour-btn">\n        <a href="/tour-detail.html?id=${e._id}" class="tour-link">Details</a>\n      </div>\n    </div>\n  </div>`;this.tourContainer.insertAdjacentHTML("beforeend",n)}updateUIForLoadBtn(){const e=document.querySelector(".load-more-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}resetUIForLoadBtn(){const e=document.querySelector(".load-more-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}new s;const P=new s;class U{constructor(){this.otpBtn=document.querySelector(".send-otp-btn")}getInput(){return{OTP:document.querySelector("[name='update-email']").value}}updateUI(){const e=document.querySelector(".send-otp-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}resetUI(){const e=document.querySelector(".send-otp-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}const L=new a;class k{constructor(){this.signupbtn=document.querySelector(".signup-btn")}getInputs(){return{email:document.getElementById("email").value,password:document.getElementById("password").value,confirmPassword:document.getElementById("confirm-password").value,name:document.getElementById("name").value}}resetInput(){document.getElementById("password").value="",document.getElementById("confirm-password").value=""}updateUI(){const e=document.querySelector(".signup-btn-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".signup-btn-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}const q=new a,b=new class{constructor(){this.tourContainer=document.querySelector(".tour-container")}generateMarkup(e,n){const o=e.reviews.length,a=`<div class="tour">\n        <i class="${n?"fas":"far"} fa-bookmark"></i>\n        <div class="tour-info">\n        <div class="tour-title">\n        <span>${e.name.toUpperCase()}</span>\n\n        </div>\n            <div class="tour-info-details">\n                <div class="tour-info-detail">\n                    <i class="far fa-clock"></i>\n                    <p>${e.tourLength} Days</p>\n                </div>\n                <div class="tour-info-detail">\n                    <i class="far fa-map"></i>\n                    <p>${e.location}</p>\n                </div>\n            </div>\n        </div>\n      </div>\n      <div class="tour-facts">\n        <div class="tour-facts-left">\n          <p class="tour-quick-facts">Quick Facts</p>\n          <div class="tour-facts-items">\n            <div class="tour-facts-item">\n              <i class="far fa-calendar-minus"></i>\n              <span>Next Date</span>\n              <p>June 2021</p>\n            </div>\n            <div class="tour-facts-item">\n              <i class="far fa-chart-bar"></i>\n              <span>Difficulty</span>\n              <p>${e.difficulty.toUpperCase()}</p>\n            </div>\n            <div class="tour-facts-item">\n              <i class="far fa-user"></i>\n              <span>Group Size</span>\n              <p>6</p>\n            </div>\n            <div class="tour-facts-item">\n              <i class="far fa-star"></i>\n              <span>Ratings</span>\n              <p>${e.averageRatings} / ${e.totalRatings}</p>\n            </div>\n          </div>\n        </div>\n        <div class="tour-facts-right">\n          <p class="tour-quick-facts">About the Mountain Biking</p>\n          <p class="tour-description">\n          ${e.info}\n          </p>\n          <p class="tour-description">\n                ${e.description}\n          </p>\n        </div>\n    </div>\n    <div class="tour-images">\n      <img src="./src/img/1.jpg" alt="">\n      <img src="./src/img/2.jpg" alt="">\n      <img src="./src/img/3.jpg" alt="">\n    </div>\n    <div class="tour-review">\n      \n    </div>\n    <div class="booking-section">\n    <img src="./src/img/1.jpg" alt="">\n  <div class="booking">\n    <h1 class="booking-text">WHAT ARE YOU WAITING FOR?</h1>\n    <p>7 days. 1 adventure. Infinite memories. Make it yours today!</p>\n  </div>\n  <button class="book-tour-btn" data-tour-id="${e._id}"> Book Tour Now </button>\n</div>\n    `;if(this.tourContainer.innerHTML="",this.tourContainer.insertAdjacentHTML("afterbegin",a),0==o){const e=document.querySelector(".tour-review");e.style.padding="0rem",e.style.marginTop="0"}if(document.querySelector(".tour").style.backgroundImage=`linear-gradient(\n      rgba(22, 160, 132, 0.8),\n      rgba(46, 204, 112, 0.8)\n    ), url("${t}/${e.headImg}")`,0!=o){const t=document.querySelector(".tour-review"),n=e.reviews.map((e=>{const t=[];for(let n=0;n<e.rating;n++)t.push('<i class="material-icons">star</i>');return`<div class="review">\n        <div class="review-info">\n          <img src="./src/img/test.jpg" alt="reviewer-img">\n          <p class="reviewer-name">${e.user.name}</p>\n        </div>\n        <p class="review-text">${e.review}</p>\n        <div class="review-ratings">\n          ${t.join("")}\n        </div>\n      </div>`}));t.innerHTML=n.join("")}}addToBookmark(e,t){document.querySelector(".fa-bookmark").addEventListener("click",(function(){e(t)}))}updateBookmarkUI(){document.querySelector(".fa-bookmark").classList.replace("far","fas")}getBookBtn(){return document.querySelector(".book-tour-btn")}},E=async e=>{const t=await o("/api/bookmark","POST",{tourId:e});"success"===t.status&&b.updateBookmarkUI(),q.showPopup(t.message),q.hidePopup()},T=new class{constructor(){this.otpBtn=document.querySelector(".login-btn")}getInput(){return{OTP:document.getElementById("email").value}}getToken(){return window.location.search.split("=")[1]}addListener(e){this.otpBtn.addEventListener("click",(async()=>{await e()}))}updateUI(){const e=document.querySelector(".login-btn-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".login-btn-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}},$=new a,x=async()=>{T.updateUI();const e=T.getToken(),t=T.getInput(),n=await o(`/api/user/2fa?token=${e}`,"POST",t);"success"===n.status?($.showPopup("Logged in successfully!"),$.hidePopup(),window.sessionStorage.setItem("isUserLoggedIn",!0),setTimeout((()=>{window.location.href="/index.html"}),2e3)):($.showPopup(n.message),$.hidePopup()),T.defaultUI()},C=new s;(async()=>{try{C.showSpinner(),await(async()=>{try{const e=await o("/api/user/about-me","GET");"success"===e.status&&(h.updateUI(e),y=!0,n=e),v.hideSpinner()}catch(e){console.log(e)}})(),await(async()=>{if("/activate-account.html"===window.location.pathname){const e=window.location.search.split("=")[1];if(!e)return window.location.href="/";const t=await o(`/api/user/activate-account?verify=${e}`,"GET");"success"===t.status?window.location.href="/login.html?activated=true":document.write(t.message)}})(),(async()=>{if("/tours.html"==window.location.pathname){P.showSpinner();const e=3,t=window.location.search.split("&").map((e=>e.replace("?",""))).filter((e=>e.includes("page="))).join("").split("=")[1],n=new B;t&&((e,t)=>{e&&(t.nextPageBtn.dataset.nextpage=e,t.currentPage.textContent=`${e}`,t.prevPageBtn.dataset.prevpage=e)})(t,n),n.loadMoreBtn.addEventListener("click",(async function(){n.updateUIForLoadBtn(),n.loadMoreBtn.dataset.page++;const t=n.loadMoreBtn.dataset.page;(await o(`/api/tour?page=${t||1}&limit=${e}`,"GET")).data.tours.forEach((e=>{n.generateMarkup(e)})),n.resetUIForLoadBtn()})),(await o(`/api/tour?page=${t||1}&limit=${e}`,"GET")).data.tours.forEach((e=>{n.generateMarkup(e)})),P.hideSpinner()}})(),(async()=>{if("/tour-detail.html"==window.location.pathname){const e=window.location.search.split("=")[1];if(!e)return window.location.href="/tours.html";await(async(e,t)=>{const n=await o(`/api/tour/${e}`,"GET"),a=await o("/api/bookmark","GET");let s=!1;"Fail"!==a.status&&(s=a.bookmarks.some((e=>e._id==n.data.tour._id))),t.generateMarkup(n.data.tour,s)})(e,b),await b.addToBookmark(E,e),b.getBookBtn().addEventListener("click",(async e=>{document.querySelector(".book-tour-btn").textContent="Processing...","Fail"==(await o("/api/user/about-me","GET")).status&&(window.location.href="/login.html");const t=window.location.search.split("=")[1],n=await o(`/api/checkout/checkout-session/${t}`,"GET"),a={order_id:n.order.id,key:"rzp_test_iQXxC9LBZRPfH9",prefill:{name:n.order.notes.name,email:n.order.notes.email}};document.querySelector(".book-tour-btn").textContent="Book Tour Now",new Razorpay(a).open()}))}})(),(async()=>{if("/forgot-password.html"==window.location.pathname){const t=new s,n=new e;n.resetBtn.addEventListener("click",(async function(){n.updateUI();const e=n.getInput();await(async e=>{const t=await o("/api/user/forgot-password","POST",e);t.status,i.showPopup(t.message),i.hidePopup()})(e),n.defaultUI()})),t.hideSpinner()}})(),(()=>{if("/reset-password.html"===window.location.pathname){const e=new s,t=window.location.search.split("=")[1];if(!t)return window.location.href="/";const n=new r;n.resetBtn.addEventListener("click",(async function(){n.updateUI();const e=n.getInput();if(e.password!==e.confirmPassword)return m.showPopup("Passwords do not match"),m.hidePopup(),void n.defaultUI();await w(e,t)})),e.hideSpinner()}})(),(()=>{if("/dashboard.html"==window.location.pathname){if(!y)return window.location.href="/login.html?notLoggedIn=true";const e=new s,t=new g;t.setInput(n),t.passwordUpdateBtn.addEventListener("click",(async function(e){(async(e,t)=>{e.preventDefault(),t.updatePasswordBtnUI();const n=t.getPasswordInput();await(async e=>{const t=await o("/api/user/update-me/password","POST",e);d.showPopup(t.message),d.hidePopup()})(n),t.resetPasswordBtnUI()})(e,t)})),t.logoutBtn.addEventListener("click",(async function(){const e=new p;await u(e)})),t.nameUpdateBtn.addEventListener("click",(async function(e){(async(e,t)=>{e.preventDefault(),t.updateNameBtnUI();const n=t.getNameInput();await(async e=>{const t=await o("/api/user/update-me/info","POST",e);d.showPopup(t.message),d.hidePopup()})(n),t.resetNameBtnUI()})(e,t)})),t.emailUpdateBtn.addEventListener("click",(async function(e){(async(e,t)=>{e.preventDefault(),t.updateEmailBtnUI();const n=t.getEmailInput();await(async e=>{const t=await o("/api/user/update-me/email","POST",e);d.showPopup(t.message),d.hidePopup()})(n),t.resetEmailBtnUI()})(e,t)})),e.hideSpinner()}})(),(()=>{if("/login.html"===window.location.pathname&&"?activated=true"===window.location.search&&setTimeout((()=>{I.showPopup("Account verified"),I.hidePopup()}),500),"/login.html"==window.location.pathname){S.showSpinner();const e=new f;e.loginBtn.addEventListener("click",(function(){(async e=>{try{e.updateUI();const t=e.getLoginInputs(),n=await o("/api/user/login","POST",t);if(n.data&&(d.showPopup(n.message),setTimeout((()=>{window.location.href=`/2fa.html?token=${n.data}`}),2e3)),"Fail"===n.status)e.defaultUI(),e.resetInput(),d.showPopup(n.message),d.hidePopup();else{const t=await o("/api/user/about-me","GET");window.sessionStorage.setItem("user",JSON.stringify(t)),window.sessionStorage.setItem("isUserLoggedIn",!0),e.defaultUI(),window.location.href="/"}}catch(e){console.log(e)}})(e)})),S.hideSpinner()}"/login.html"==window.location.pathname&&"?notLoggedIn=true"===window.location.search&&setTimeout((()=>{I.showPopup("You are not logged in! Please log in."),I.hidePopup()}),500)})(),(()=>{if("/signup.html"==window.location.pathname){const e=new k;e.signupbtn.addEventListener("click",(function(){(async e=>{e.updateUI();const t=e.getInputs(),n=await o("/api/user/signup","POST",t);n.data?d.showPopup(n.data.message):d.showPopup(n.message),e.resetInput(),d.hidePopup(),e.defaultUI()})(e)}))}})(),(()=>{if("/update-email.html"===window.location.pathname){const e=new U,t=window.location.search.split("=")[1];if(!t)return window.location.href="/";e.otpBtn.addEventListener("click",(async function(){e.updateUI();const n=e.getInput();await(async(e,t)=>{const n=await o(`/api/user/update-email?token=${t}`,"POST",e);L.showPopup(n.message),L.hidePopup(),"success"===n.status&&setTimeout((()=>{window.location.href="/login.html"}),2e3)})(n,t),e.resetUI()}))}})(),"/2fa.html"==window.location.pathname&&T.addListener(x),C.hideSpinner()}catch(e){console.log(e)}})()})();