(()=>{"use strict";class e{constructor(){this.resetBtn=document.querySelector(".forgot-btn")}getInput(){return{email:document.getElementById("email").value}}updateUI(){const e=document.querySelector(".forgot-btn"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".forgot-btn"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}let t={};const n=async(e,t,n)=>{const o={method:t,credentials:"include",headers:{"Content-Type":"application/json"}};n&&(o.body=JSON.stringify(n));try{const t=await fetch(`http://localhost:9090${e}`,o);return await t.json()}catch(e){console.log(e)}};class o{constructor(){}showPopup(e){const t=document.querySelector(".popup");t.textContent=e,t.style.display="block",t.style.opacity="1"}hidePopup(){setTimeout((()=>{const e=document.querySelector(".popup");e.style.display="none",e.style.opacity="0"}),3e3)}}class s{constructor(){this.bg=document.querySelector(".bg")}showSpinner(){this.bg.classList.remove("hidden")}hideSpinner(){this.bg.classList.add("hidden")}}const a=new o;class i{constructor(){this.resetBtn=document.querySelector(".reset-btn")}getInput(){const e=document.querySelector("[name='new-password']").value,t=document.querySelector("[name='confirm-new-password']").value;return{password:e.toString(),confirmPassword:t.toString()}}updateUI(){const e=document.querySelector(".reset-btn-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".reset-btn-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}const c=new s,d=new o,r=async e=>{try{await n("/api/user/logout","GET"),e.defaultUI(),window.location.href="/",c.hideSpinner()}catch(e){console.log(e)}},u=new s;class l{constructor(){this.navBarList=document.querySelector(".list")}updateUI(e){const t=document.querySelector(".user-not-loggedin"),n=document.querySelector(".user-loggedin");document.querySelector(".user-name").innerText=`Welcome, ${e.data.user.name.split(" ")[0]}`,t.classList.add("hidden"),n.classList.remove("hidden"),u.hideSpinner()}defaultUI(){const e=document.querySelector(".user-not-loggedin"),t=document.querySelector(".user-loggedin");e.classList.remove("hidden"),t.classList.add("hidden")}getlogoutBtn(){const e=document.querySelector(".logout-btn");if(e)return e}}const p=new o,m=async(e,t)=>{const o=await n(`/api/user/reset-password?token=${t}`,"POST",e);if("Fail"===o.status)p.showPopup(o.message),p.hidePopup(),resetPasswordView.defaultUI();else{p.showPopup(o.message),p.hidePopup();const e=new l;setTimeout((async()=>{await r(e)}),2e3),resetPasswordView.defaultUI()}};class w{constructor(){this.passwordUpdateBtn=document.querySelector(".password-save-btn"),this.logoutBtn=document.querySelector(".log-out-btn"),this.nameUpdateBtn=document.querySelector(".name-save-btn"),this.emailUpdateBtn=document.querySelector(".email-save-btn")}setInput(e){document.getElementById("account-name").value=e.data.user.name,document.getElementById("account-email").value=e.data.user.email}getPasswordInput(){return{currentPassword:document.getElementById("current-password").value,newPassword:document.getElementById("new-password").value,confirmNewPassword:document.getElementById("confirm-new-password").value}}getNameInput(){return{name:document.getElementById("account-name").value}}getEmailInput(){return{email:document.getElementById("account-email").value}}resetInput(){document.getElementById("current-password").value="",document.getElementById("new-password").value="",document.getElementById("confirm-new-password").value=""}updatePasswordBtnUI(){this.passwordUpdateBtn.textContent="Updating..."}resetPasswordBtnUI(){this.passwordUpdateBtn.textContent="Update Password"}updateNameBtnUI(){this.nameUpdateBtn.textContent="Updating..."}resetNameBtnUI(){this.nameUpdateBtn.textContent="Update Name"}updateEmailBtnUI(){this.emailUpdateBtn.textContent="Updating..."}resetEmailBtnUI(){this.emailUpdateBtn.textContent="Update Email"}}const h=new l,g=new s;let y=!1;class I{constructor(){this.loginBtn=document.querySelector(".login-btn")}getLoginInputs(){return{email:document.getElementById("email").value,password:document.getElementById("password").value}}updateUI(){const e=document.querySelector(".login-btn-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".login-btn-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}resetInput(){document.getElementById("password").value=""}disableLoginBtn(){this.loginBtn.disabled=!0}}const f=new o,v=new s;class S{constructor(){this.tourContainer=document.querySelector(".tour-container")}generateMarkup(e){const t=` <div class="tour">\n    <div class="tour-header">\n      <span class="image-overlay"></span>\n      <img src="./src/img/biking.jpg" alt="" class="tour-img">\n    </div>\n    <div class="tour-content">\n      <p class="tour-title">${e.name}</p>\n      <p class="tour-content-fact">${e.difficulty.toUpperCase()} ${e.tourLength} Days </p>\n      <p class="tour-content-info">${e.info}\n      </p>\n      <div class="tour-icons">\n        <div class="tour-content-icon">\n          <i class="far fa-map"></i>\n          <p>${e.location}</p>\n        </div>\n        <div class="tour-content-icon">\n          <i class="far fa-calendar"></i>\n          <p>June 2022</p>\n        </div>\n        <div class="tour-content-icon">\n          <i class="far fa-user"></i>\n          <p>${e.groupSize}</p>\n        </div>\n        <div class="tour-content-icon">\n          <i class="far fa-hourglass"></i>\n          <p>${e.tourLength}</p>\n        </div>\n      </div>\n    </div>\n    <div class="tour-footer">\n      <div class="tour-ratings">\n        <p class="tour-price">$${e.price} <span>per person</span></p>\n        <div class="tour-rating">${e.averageRatings} <span>rating (${e.totalRatings})</span></div>\n      </div>\n      <div class="tour-btn">\n        <a href="/tour-detail/?id=${e._id}" class="tour-link">Details</a>\n      </div>\n    </div>\n  </div>`;this.tourContainer.insertAdjacentHTML("afterbegin",t)}}class U{constructor(){this.otpBtn=document.querySelector(".send-otp-btn")}getInput(){return{OTP:document.querySelector("[name='update-email']").value}}updateUI(){const e=document.querySelector(".send-otp-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}resetUI(){const e=document.querySelector(".send-otp-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}const B=new o;class P{constructor(){this.signupbtn=document.querySelector(".signup-btn")}getInputs(){return{email:document.getElementById("email").value,password:document.getElementById("password").value,confirmPassword:document.getElementById("confirm-password").value,name:document.getElementById("name").value}}resetInput(){document.getElementById("password").value="",document.getElementById("confirm-password").value=""}updateUI(){const e=document.querySelector(".signup-btn-text"),t=document.querySelector(".loader");e.classList.add("hidden"),t.classList.remove("hidden")}defaultUI(){const e=document.querySelector(".signup-btn-text"),t=document.querySelector(".loader");e.classList.remove("hidden"),t.classList.add("hidden")}}const L=new s;(async()=>{try{L.showSpinner(),await(async()=>{try{const e=await n("/api/user/about-me","GET");"success"===e.status&&(h.updateUI(e),y=!0,t=e),g.hideSpinner()}catch(e){console.log(e)}})(),await(async()=>{if("/activate-account.html"===window.location.pathname){const e=window.location.search.split("=")[1];if(!e)return window.location.href="/";const t=await n(`/api/user/activate-account?verify=${e}`,"GET");"success"===t.status?window.location.href="/login.html?activated=true":document.write(t.message)}})(),(async()=>{if("/tours.html"==window.location.pathname){const e=new s,t=new S;(await n("/api/tour","GET")).data.tours.forEach((e=>{t.generateMarkup(e)})),e.hideSpinner()}})(),(async()=>{if("/forgot-password.html"==window.location.pathname){const t=new s,o=new e;o.resetBtn.addEventListener("click",(async function(){o.updateUI();const e=o.getInput();await(async e=>{const t=await n("/api/user/forgot-password","POST",e);t.status,a.showPopup(t.message),a.hidePopup()})(e),o.defaultUI()})),t.hideSpinner()}})(),(()=>{if("/reset-password.html"===window.location.pathname){const e=new s,t=window.location.search.split("=")[1];if(!t)return window.location.href="/";const n=new i;n.resetBtn.addEventListener("click",(async function(){n.updateUI();const e=n.getInput();if(e.password!==e.confirmPassword)return p.showPopup("Passwords do not match"),p.hidePopup(),void n.defaultUI();await m(e,t)})),e.hideSpinner()}})(),(()=>{if("/dashboard.html"==window.location.pathname){if(!y)return window.location.href="/login.html?notLoggedIn=true";const e=new s,o=new w;o.setInput(t),o.passwordUpdateBtn.addEventListener("click",(async function(e){(async(e,t)=>{e.preventDefault(),t.updatePasswordBtnUI();const o=t.getPasswordInput();await(async e=>{const t=await n("/api/user/update-me/password","POST",e);d.showPopup(t.message),d.hidePopup()})(o),t.resetPasswordBtnUI()})(e,o)})),o.logoutBtn.addEventListener("click",(async function(){const e=new l;await r(e)})),o.nameUpdateBtn.addEventListener("click",(async function(e){(async(e,t)=>{e.preventDefault(),t.updateNameBtnUI();const o=t.getNameInput();await(async e=>{const t=await n("/api/user/update-me/info","POST",e);d.showPopup(t.message),d.hidePopup()})(o),t.resetNameBtnUI()})(e,o)})),o.emailUpdateBtn.addEventListener("click",(async function(e){(async(e,t)=>{e.preventDefault(),t.updateEmailBtnUI();const o=t.getEmailInput();await(async e=>{const t=await n("/api/user/update-me/email","POST",e);d.showPopup(t.message),d.hidePopup()})(o),t.resetEmailBtnUI()})(e,o)})),e.hideSpinner()}})(),(()=>{if("/login.html"===window.location.pathname&&"?activated=true"===window.location.search&&setTimeout((()=>{f.showPopup("Account verified"),f.hidePopup()}),500),"/login.html"==window.location.pathname){v.showSpinner();const e=new I;e.loginBtn.addEventListener("click",(function(){(async e=>{try{e.updateUI();const t=e.getLoginInputs(),o=await n("/api/user/login","POST",t);if("Fail"===o.status)e.defaultUI(),e.resetInput(),d.showPopup(o.message),d.hidePopup();else{const t=await n("/api/user/about-me","GET");window.sessionStorage.setItem("user",JSON.stringify(t)),window.sessionStorage.setItem("isUserLoggedIn",!0),e.defaultUI(),window.location.href="/"}}catch(e){console.log(e)}})(e)})),v.hideSpinner()}"/login.html"==window.location.pathname&&"?notLoggedIn=true"===window.location.search&&setTimeout((()=>{f.showPopup("You are not logged in! Please log in."),f.hidePopup()}),500)})(),(()=>{if("/signup.html"==window.location.pathname){const e=new P;e.signupbtn.addEventListener("click",(function(){(async e=>{e.updateUI();const t=e.getInputs(),o=await n("/api/user/signup","POST",t);o.data?d.showPopup(o.data.message):d.showPopup(o.message),e.resetInput(),d.hidePopup(),e.defaultUI()})(e)}))}})(),(()=>{if("/update-email.html"===window.location.pathname){const e=new U,t=window.location.search.split("=")[1];if(!t)return window.location.href="/";e.otpBtn.addEventListener("click",(async function(){e.updateUI();const o=e.getInput();await(async(e,t)=>{const o=await n(`/api/user/update-email?token=${t}`,"POST",e);B.showPopup(o.message),B.hidePopup(),"success"===o.status&&setTimeout((()=>{window.location.href="/login.html"}),2e3)})(o,t),e.resetUI()}))}})(),L.hideSpinner()}catch(e){console.log(e)}})()})();